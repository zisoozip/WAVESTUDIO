<!DOCTYPE html>
<html lang=ko>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>자유로운 원형 파동</title>
<link href=https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css rel=stylesheet>
<style>body{margin:0;overflow:hidden;font-family:'Pretendard',sans-serif;background:#000;color:#fff;transition:background-color .5s ease,color .5s ease;cursor:none}body.light-mode{background:#fff;color:#333}.custom-cursor{position:fixed;width:96px;height:96px;background-image:url('image/mou.png');background-size:contain;background-repeat:no-repeat;background-position:center;pointer-events:none;transform:translate(-50%,-50%);z-index:9999;transition:transform .05s ease;opacity:0}.custom-cursor.image-loaded{opacity:1}.custom-cursor.clicking{transform:translate(-50%,-50%) scale(0.8)}.custom-cursor.hovering{transform:translate(-50%,-50%) scale(1.2)}input,textarea,select{cursor:text!important}canvas{display:block}#loading-screen{position:fixed;top:0;left:0;width:100%;height:100vh;background-color:#000;z-index:1000;overflow:hidden}#loading-screen.hidden{opacity:0;pointer-events:none;transition:opacity .5s ease}.brand-section{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;text-align:center}.brand-title{font-size:4rem;font-weight:700;letter-spacing:-0.03em;margin-bottom:30px;opacity:1;background:linear-gradient(135deg,#fff 0,#ffffff 50%,#ffffff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.brand-description{font-size:1.2rem;line-height:1.8;opacity:.9;max-width:600px;margin:0 auto}.preview-window{position:absolute;right:80px;top:50%;transform:translateY(-50%);width:600px;height:450px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:16px;backdrop-filter:blur(25px);overflow:hidden;opacity:0;transform:translateY(-50%) scale(0.9) rotateY(10deg);transition:all .8s cubic-bezier(0.4,0,0.2,1);box-shadow:0 20px 60px rgba(0,0,0,0.3)}.preview-window.visible{opacity:1;transform:translateY(-50%) scale(1) rotateY(0deg)}.preview-header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.12);display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.02)}.preview-dots{display:flex;gap:8px}.preview-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.4);transition:all .3s ease}.preview-dot:nth-child(1){background:#ff5f57}.preview-dot:nth-child(2){background:#ffbd2e}.preview-dot:nth-child(3){background:#28ca42}.preview-title{font-size:.9rem;margin-left:auto;opacity:.8;font-weight:500}.preview-content{position:relative;width:100%;height:calc(100% - 48px);background:#000;overflow:hidden;border-radius:0 0 16px 16px}.preview-canvas{width:100%;height:100%;object-fit:cover}.loading-section{position:absolute;left:80px;bottom:120px;text-align:left}.loading-number{font-size:30rem;font-weight:500;line-height:.8;letter-spacing:-0.05em;background:linear-gradient(45deg,#fff,#ccc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;transition:all .3s cubic-bezier(0.4,0,0.2,1);transform-origin:bottom right}.progress-bar{position:absolute;bottom:80px;right:60px;width:400px;height:1px;background-color:rgba(255,255,255,0.1);overflow:hidden}.progress-fill{height:100%;background:linear-gradient(90deg,#fff,#ccc);transition:width .1s ease;box-shadow:0 0 20px rgba(255,255,255,0.3)}@keyframes gentlePulse{0%,100%{transform:scale(1);text-shadow:0 0 100px rgba(255,255,255,0.2)}50%{transform:scale(1.01);text-shadow:0 0 120px rgba(255,255,255,0.3)}}.number-pulsing{animation:gentlePulse 3s ease-in-out infinite}#home-button{position:fixed;left:24px;top:24px;z-index:10000;width:48px;height:48px;background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.2);border-radius:12px;cursor:pointer!important;display:flex;align-items:center;justify-content:center;transition:all .3s ease;pointer-events:all}#home-button:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px);border-color:rgba(255,255,255,0.3);cursor:pointer!important}#home-button svg{width:20px;height:20px;fill:rgba(255,255,255,0.8);transition:fill .3s ease;pointer-events:none}#home-button:hover svg{fill:rgba(255,255,255,1)}body.light-mode #home-button{background:rgba(255,255,255,0.8);border-color:rgba(0,0,0,0.1)}body.light-mode #home-button:hover{background:rgba(255,255,255,0.95);border-color:rgba(0,0,0,0.15)}body.light-mode #home-button svg{fill:rgba(0,0,0,0.6)}body.light-mode #home-button:hover svg{fill:rgba(0,0,0,0.8)}.control-buttons{position:fixed;top:24px;right:24px;display:flex;gap:8px;z-index:10000}.control-button{padding:10px 16px;background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:rgba(255,255,255,0.9);cursor:pointer;font-size:13px;font-weight:500;font-family:'Pretendard',sans-serif;transition:all .3s ease;display:flex;align-items:center;gap:6px}.control-button:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px);border-color:rgba(255,255,255,0.3)}.control-button:active{transform:translateY(0)}body.light-mode .control-button{background:rgba(255,255,255,0.8);border-color:rgba(0,0,0,0.1);color:rgba(0,0,0,0.7)}body.light-mode .control-button:hover{background:rgba(255,255,255,0.95);border-color:rgba(0,0,0,0.15);color:rgba(0,0,0,0.9)}#instructions{position:fixed;bottom:24px;left:24px;background:rgba(0,0,0,0.8);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:20px;font-size:14px;z-index:100;width:320px;transition:all .3s ease}body.light-mode #instructions{background:rgba(255,255,255,0.9);color:#333;border:1px solid rgba(0,0,0,0.1)}#instructions h3{margin:0 0 12px 0;font-size:15px;font-weight:600;color:rgba(255,255,255,0.9);border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:6px}body.light-mode #instructions h3{color:rgba(0,0,0,0.8);border-bottom-color:rgba(0,0,0,0.1)}#instructions p{margin:6px 0;line-height:1.5;display:flex;align-items:center;color:rgba(255,255,255,0.8)}body.light-mode #instructions p{color:rgba(0,0,0,0.7)}.key{display:inline-flex;align-items:center;justify-content:center;padding:2px 5px;margin:0 5px 0 0;font-family:'SF Mono','Monaco','Cascadia Code',monospace;font-size:10px;font-weight:500;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.2);border-radius:3px;color:rgba(255,255,255,0.9);min-width:18px}body.light-mode .key{background:rgba(0,0,0,0.06);border-color:rgba(0,0,0,0.1);color:rgba(0,0,0,0.8)}#instructions:hover{transform:translateY(-1px)}body.light-mode #instructions:hover{transform:translateY(-1px)}@media(max-width:768px){.brand-title{font-size:2.5rem}.loading-number{font-size:14rem}.preview-window{width:320px;height:240px;left:40px;bottom:60px}#instructions{width:calc(100vw - 48px);bottom:16px;left:16px;padding:20px}.control-buttons{top:16px;right:16px;gap:8px}.control-button{padding:10px 16px;font-size:13px}#home-button{left:16px;top:16px;width:48px;height:48px}#home-button svg{width:24px;height:24px}}::-webkit-scrollbar{display:none}*{-ms-overflow-style:none;scrollbar-width:none}::selection{background:rgba(255,255,255,0.2);color:inherit}::-moz-selection{background:rgba(255,255,255,0.2);color:inherit}</style>
</head>
<body>
<div class=custom-cursor id=customCursor></div>
<div id=loading-screen>
<div class=brand-section>
<div class=brand-title>Circle Ripples</div>
<div class=brand-description>
3D 심연 속에서 물결치는 환상의 세계.<br>
마우스와 키보드로 다양한 원형 파동을 탐험해보세요.
</div>
</div>
<div class=preview-window id=previewWindow>
<div class=preview-header>
<div class=preview-dots>
<div class=preview-dot></div>
<div class=preview-dot></div>
<div class=preview-dot></div>
</div>
<div class=preview-title>Live Preview</div>
</div>
<div class=preview-content>
<canvas class=preview-canvas id=previewCanvas></canvas>
</div>
</div>
<div class=loading-section>
<div class=loading-number id=loadingNumber>0</div>
</div>
<div class=progress-bar>
<div class=progress-fill id=progressFill></div>
</div>
</div>
<div id=home-button>
<svg viewBox="0 0 24 24">
<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
</svg>
</div>
<div class=control-buttons>
<button class=control-button id=themeBtn>
<span>🌙</span>
<span>DARK</span>
</button>
<button class=control-button id=resetBtn>
<span>↻</span>
<span>RESET</span>
</button>
</div>
<div id=instructions>
<h3>조작 방법</h3>
<p><span class=key>마우스 이동</span>시점 변경</p>
<p><span class=key>마우스 클릭</span>새로운 파동 생성</p>
<p><span class=key>W</span><span class=key>S</span>파동 개수 증가/감소</p>
<p><span class=key>A</span><span class=key>D</span>파동 속도 감소/증가</p>
<p><span class=key>Q</span><span class=key>E</span>파동 색상 변경</p>
<p><span class=key>Z</span><span class=key>X</span>파동 폭 조절</p>
<p><span class=key>R</span>카메라 회전 모드 전환</p>
<p><span class=key>F</span>자동 파동 생성 토글</p>
<p><span class=key>T</span>다크/라이트 모드 전환</p>
<p><span class=key>스페이스바</span>카메라 위치 재설정</p>
</div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js></script>
<script>function goHome(){try{console.log('홈 버튼 클릭됨!');if(window.location.protocol==='file:'){window.location.href='./index.html#list-section';}else{window.location.href='./index.html#list-section';}}catch(error){console.error('홈 페이지 이동 오류:',error);if(window.location.protocol==='file:'){window.location.href='./index.html';}else{window.location.href='./index.html';}}}
function setupHomeButton(){const homeButton=document.getElementById('home-button');if(homeButton){console.log('홈 버튼 찾음:',homeButton);homeButton.addEventListener('click',function(e){console.log('홈 버튼 클릭 이벤트 발생');e.preventDefault();e.stopPropagation();goHome();});homeButton.addEventListener('mousedown',function(e){console.log('홈 버튼 마우스다운 이벤트');e.stopPropagation();});homeButton.addEventListener('touchstart',function(e){console.log('홈 버튼 터치 이벤트');e.preventDefault();e.stopPropagation();goHome();},{passive:false});homeButton.style.pointerEvents='all';homeButton.style.cursor='pointer';}else{console.error('홈 버튼을 찾을 수 없습니다');}}
document.addEventListener('DOMContentLoaded',setupHomeButton);let currentNumber=0;let displayNumber=0;const targetNumber=100;const loadingNumberEl=document.getElementById('loadingNumber');const progressFillEl=document.getElementById('progressFill');const previewWindow=document.getElementById('previewWindow');let animationId;let startTime;const duration=4000;let previewScene,previewCamera,previewRenderer;let previewRings=[];let previewTime=0;let previewAnimationId;class CustomCursor{constructor(){this.cursor=document.getElementById('customCursor');this.mouseX=window.innerWidth/2;this.mouseY=window.innerHeight/2;this.isClicking=false;this.imageLoaded=false;this.preloadCursorImage();this.init();}
preloadCursorImage(){const img=new Image();img.onload=()=>{this.imageLoaded=true;if(this.cursor){this.cursor.classList.add('image-loaded');this.cursor.style.opacity='1';}};img.onerror=()=>{document.body.style.cursor='auto';if(this.cursor){this.cursor.style.display='none';}};img.src='image/mou.png';}
init(){if(!this.cursor)return;this.updateCursorPosition();document.addEventListener('mousemove',(e)=>{this.mouseX=e.clientX;this.mouseY=e.clientY;this.updateCursorPosition();});document.addEventListener('mousedown',()=>{this.isClicking=true;this.cursor.classList.add('clicking');});document.addEventListener('mouseup',()=>{this.isClicking=false;this.cursor.classList.remove('clicking');});document.addEventListener('mouseenter',(e)=>{if(this.isHoverTarget(e.target)){if(!this.isClicking){this.cursor.classList.add('hovering');}}},true);document.addEventListener('mouseleave',(e)=>{if(this.isHoverTarget(e.target)){this.cursor.classList.remove('hovering');}},true);}
isHoverTarget(element){if(!element||!element.classList)return false;const targetClasses=['control-button'];const targetTags=['BUTTON'];const targetIds=['home-button'];for(let className of targetClasses){if(element.classList.contains(className)){return true;}}
if(element.tagName&&targetTags.includes(element.tagName.toUpperCase())){return true;}
if(element.id&&targetIds.includes(element.id)){return true;}
return false;}
updateCursorPosition(){if(this.cursor&&this.imageLoaded){const homeButton=document.getElementById('home-button');if(homeButton){const rect=homeButton.getBoundingClientRect();const buffer=10;if(this.mouseX>=rect.left-buffer&&this.mouseX<=rect.right+buffer&&this.mouseY>=rect.top-buffer&&this.mouseY<=rect.bottom+buffer){this.cursor.style.opacity='0';document.body.style.cursor='pointer';return;}else{this.cursor.style.opacity='1';document.body.style.cursor='none';}}
this.cursor.style.left=this.mouseX+'px';this.cursor.style.top=this.mouseY+'px';}}}
function animateLoadingNumber(timestamp){if(!startTime)startTime=timestamp;const elapsed=timestamp-startTime;const progress=Math.min(elapsed/duration,1);const easedProgress=1-Math.pow(1-progress,3);displayNumber=easedProgress*targetNumber;const roundedNumber=progress>=1?targetNumber:Math.floor(displayNumber);loadingNumberEl.textContent=roundedNumber;const progressPercentage=(roundedNumber/targetNumber)*100;progressFillEl.style.width=progressPercentage+'%';if(roundedNumber>=30&&!previewWindow.classList.contains('visible')){previewWindow.classList.add('visible');initPreview();}
if(progress<1){animationId=requestAnimationFrame(animateLoadingNumber);}else{loadingNumberEl.classList.remove('number-pulsing');loadingNumberEl.style.transform='scale(1.1)';loadingNumberEl.style.textShadow='0 0 150px rgba(255, 255, 255, 0.6)';setTimeout(()=>{loadingNumberEl.style.transform='scale(1)';loadingNumberEl.style.textShadow='0 0 100px rgba(255, 255, 255, 0.2)';},300);setTimeout(()=>{if(previewAnimationId){cancelAnimationFrame(previewAnimationId);}
document.getElementById('loading-screen').classList.add('hidden');setTimeout(()=>{init();setupHomeButton();},500);},1000);}}
function initPreview(){const previewCanvas=document.getElementById('previewCanvas');const previewContainer=previewCanvas.parentElement;previewScene=new THREE.Scene();previewScene.background=new THREE.Color(0x000000);previewCamera=new THREE.PerspectiveCamera(75,previewContainer.clientWidth/previewContainer.clientHeight,0.1,1000);previewCamera.position.set(0,8,12);previewCamera.lookAt(0,0,0);previewRenderer=new THREE.WebGLRenderer({canvas:previewCanvas,antialias:true});previewRenderer.setSize(previewContainer.clientWidth,previewContainer.clientHeight);const previewAmbientLight=new THREE.AmbientLight(0x404040,0.4);previewScene.add(previewAmbientLight);const previewDirectionalLight=new THREE.DirectionalLight(0xffffff,0.6);previewDirectionalLight.position.set(5,15,7.5);previewScene.add(previewDirectionalLight);createPreviewParticles();animatePreview();}
function createPreviewParticles(){const particlesGeometry=new THREE.BufferGeometry();const particleCount=200;const positions=new Float32Array(particleCount*3);const particleColors=new Float32Array(particleCount*3);for(let i=0;i<particleCount;i++){const radius=15+20*Math.random();const theta=2*Math.random()*Math.PI;const phi=Math.acos(2*Math.random()-1);positions[i*3]=radius*Math.sin(phi)*Math.cos(theta);positions[i*3+1]=radius*Math.sin(phi)*Math.sin(theta)-5;positions[i*3+2]=radius*Math.cos(phi);const blueIntensity=Math.random();particleColors[i*3]=1.0-blueIntensity*0.4;particleColors[i*3+1]=1.0-blueIntensity*0.2;particleColors[i*3+2]=1.0;}
particlesGeometry.setAttribute("position",new THREE.BufferAttribute(positions,3));particlesGeometry.setAttribute("color",new THREE.BufferAttribute(particleColors,3));const particlesMaterial=new THREE.PointsMaterial({size:0.3,vertexColors:true,transparent:true,opacity:0.8});const particlesMesh=new THREE.Points(particlesGeometry,particlesMaterial);previewScene.add(particlesMesh);}
function createPreviewRing(radius){const segments=Math.max(16,Math.floor(radius*2));const geometry=new THREE.RingGeometry(radius,radius+0.03,segments);const material=new THREE.MeshBasicMaterial({color:0x2389da,transparent:true,opacity:0.8,side:THREE.DoubleSide});const ring=new THREE.Mesh(geometry,material);ring.rotation.x=-Math.PI/2;ring.position.set(0,-2,0);ring.userData={radius:radius,birthTime:previewTime};previewScene.add(ring);previewRings.push(ring);return ring;}
function animatePreview(){previewAnimationId=requestAnimationFrame(animatePreview);previewTime+=0.02;if(previewTime%1<0.02){createPreviewRing(0.5);}
for(let i=previewRings.length-1;i>=0;i--){const ring=previewRings[i];const age=previewTime-ring.userData.birthTime;const newRadius=0.5+age*2;if(newRadius>8){previewScene.remove(ring);previewRings.splice(i,1);continue;}
const opacity=0.8*(1-newRadius/8);ring.material.opacity=opacity;if(Math.abs(ring.userData.radius-newRadius)>0.1){previewScene.remove(ring);const newGeometry=new THREE.RingGeometry(newRadius,newRadius+0.03,Math.max(16,Math.floor(newRadius*2)));const newRing=new THREE.Mesh(newGeometry,ring.material);newRing.rotation.x=-Math.PI/2;newRing.position.copy(ring.position);newRing.userData={radius:newRadius,birthTime:ring.userData.birthTime};previewScene.add(newRing);previewRings[i]=newRing;}}
const particles=previewScene.children.find(child=>child.type==='Points');if(particles){particles.rotation.y+=0.002;}
previewRenderer.render(previewScene,previewCamera);}
let isDarkMode=true;let scene,camera,renderer,clock,raycaster,mouse,rotationMode=false,waveRings=[],waveCount=15,speed=1,colorindex=0,cameraOrbit=0,waveSources=[],autoWaveGeneration=true,ringWidth=0.02,autoWaveInterval;const waveParams={minRadius:0.5,maxRadius:40,ringCount:waveCount,height:-2};const colors=[0x2389da,0x23daac,0xda2367,0xdac623,0x8c23da,0x00ff00,0xff6b00,0xff00aa,0x00aaff,0xffff00];const magicPalettes=[["#00008B","#0000FF","#1E90FF","#00BFFF","#87CEFA"],["#8B008B","#9400D3","#9932CC","#BA55D3","#E6E6FA"],["#8B0000","#FF0000","#FF4500","#FF6347","#FFA07A"],["#006400","#228B22","#32CD32","#90EE90","#98FB98"],["#FF1493","#FF69B4","#FFB6C1","#FFC0CB","#FFDAB9"]];let currentMagicPalette=0;function toggleTheme(){isDarkMode=!isDarkMode;const body=document.body;const themeBtn=document.getElementById('themeBtn');if(isDarkMode){body.classList.remove('light-mode');themeBtn.innerHTML='<span>🌙</span><span>DARK</span>';scene.background=new THREE.Color(0x000000);scene.fog=new THREE.FogExp2(0x000000,0.008);}else{body.classList.add('light-mode');themeBtn.innerHTML='<span>☀️</span><span>LIGHT</span>';scene.background=new THREE.Color(0xffffff);scene.fog=new THREE.FogExp2(0xe6e6e6,0.003);}
updateBackgroundParticlesColor();}
function init(){scene=new THREE.Scene();scene.background=new THREE.Color(0);scene.fog=new THREE.FogExp2(0,0.008);clock=new THREE.Clock();camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);camera.position.set(0,15,20);camera.lookAt(0,0,0);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(window.innerWidth,window.innerHeight);renderer.setPixelRatio(window.devicePixelRatio);document.body.appendChild(renderer.domElement);const ambientLight=new THREE.AmbientLight(0x404040,0.4);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,0.6);directionalLight.position.set(5,15,7.5);scene.add(directionalLight);raycaster=new THREE.Raycaster();mouse=new THREE.Vector2();createBackgroundParticles();window.addEventListener("resize",onWindowResize);window.addEventListener("mousemove",onMouseMove);window.addEventListener("click",createWaveAtClick);window.addEventListener("keydown",onKeyDown);document.getElementById("resetBtn").addEventListener("click",resetScene);document.getElementById("themeBtn").addEventListener("click",toggleTheme);autoWaveGeneration=false;animate();}
function createCircleTexture(){const canvas=document.createElement('canvas');canvas.width=64;canvas.height=64;const context=canvas.getContext('2d');const centerX=32;const centerY=32;const radius=30;const gradient=context.createRadialGradient(centerX,centerY,0,centerX,centerY,radius);gradient.addColorStop(0,'rgba(255,255,255,1)');gradient.addColorStop(0.8,'rgba(255,255,255,0.8)');gradient.addColorStop(1,'rgba(255,255,255,0)');context.fillStyle=gradient;context.beginPath();context.arc(centerX,centerY,radius,0,Math.PI*2);context.fill();const texture=new THREE.CanvasTexture(canvas);return texture;}
function createBackgroundParticles(){const particlesGeometry=new THREE.BufferGeometry();const particleCount=1200;const positions=new Float32Array(particleCount*3);const particleColors=new Float32Array(particleCount*3);const sizes=new Float32Array(particleCount);for(let i=0;i<particleCount;i++){if(i<particleCount*0.6){const galaxyAngle=Math.random()*Math.PI*2;const galaxyRadius=40+80*Math.random();const galaxyHeight=(Math.random()-0.5)*20;positions[i*3]=Math.cos(galaxyAngle)*galaxyRadius;positions[i*3+1]=galaxyHeight-20;positions[i*3+2]=Math.sin(galaxyAngle)*galaxyRadius;}else{const radius=30+100*Math.random();const theta=2*Math.random()*Math.PI;const phi=Math.acos(2*Math.random()-1);positions[i*3]=radius*Math.sin(phi)*Math.cos(theta);positions[i*3+1]=radius*Math.sin(phi)*Math.sin(theta)-15;positions[i*3+2]=radius*Math.cos(phi);}
const blueIntensity=Math.random();if(isDarkMode){particleColors[i*3]=1.0-blueIntensity*0.4;particleColors[i*3+1]=1.0-blueIntensity*0.2;particleColors[i*3+2]=1.0;}else{particleColors[i*3]=0.2+blueIntensity*0.5;particleColors[i*3+1]=0.3+blueIntensity*0.5;particleColors[i*3+2]=0.8+blueIntensity*0.2;}
sizes[i]=0.3+Math.random()*0.7;}
particlesGeometry.setAttribute("position",new THREE.BufferAttribute(positions,3));particlesGeometry.setAttribute("color",new THREE.BufferAttribute(particleColors,3));particlesGeometry.setAttribute("size",new THREE.BufferAttribute(sizes,1));const particlesMaterial=new THREE.PointsMaterial({size:0.5,vertexColors:true,transparent:true,opacity:isDarkMode?0.9:0.8,sizeAttenuation:true,alphaTest:0.1,map:createCircleTexture()});const particlesMesh=new THREE.Points(particlesGeometry,particlesMaterial);particlesMesh.name="backgroundParticles";scene.add(particlesMesh);particlesMesh.userData={rotationSpeed:0.0001,twinklePhases:new Float32Array(particleCount).map(()=>Math.random()*Math.PI*2),originalSizes:new Float32Array(sizes)};}
function updateBackgroundParticlesColor(){const particles=scene.getObjectByName("backgroundParticles");if(particles){const colors=particles.geometry.attributes.color;const particleCount=colors.count;for(let i=0;i<particleCount;i++){const blueIntensity=Math.random();if(isDarkMode){colors.setXYZ(i,1.0-blueIntensity*0.4,1.0-blueIntensity*0.2,1.0);}else{colors.setXYZ(i,0.2+blueIntensity*0.5,0.3+blueIntensity*0.5,0.8+blueIntensity*0.2);}}
colors.needsUpdate=true;particles.material.opacity=isDarkMode?0.9:0.8;particles.material.needsUpdate=true;}}
function startAutoWaveGeneration(){if(autoWaveInterval){clearInterval(autoWaveInterval);}
autoWaveInterval=setInterval(function(){if(autoWaveGeneration&&waveSources.length<8){const angle=Math.random()*Math.PI*2;const radius=5+15*Math.random();const x=Math.cos(angle)*radius;const z=Math.sin(angle)*radius;createWaveSource(new THREE.Vector3(x,0,z),true);}},3000);}
function resetScene(){for(let i=waveSources.length-1;i>=0;i--){for(let j=0;j<waveSources[i].rings.length;j++){scene.remove(waveSources[i].rings[j]);}}
waveSources=[];waveRings=[];const particles=scene.getObjectByName("backgroundParticles");if(particles){scene.remove(particles);}
createBackgroundParticles();gsap.to(camera.position,{x:0,y:15,z:20,duration:1.5,ease:"power2.inOut"});camera.lookAt(0,0,0);rotationMode=false;const flashGeometry=new THREE.PlaneGeometry(100,100);const flashMaterial=new THREE.MeshBasicMaterial({color:isDarkMode?0xffffff:0x333333,transparent:true,opacity:0.8,side:THREE.DoubleSide});const flash=new THREE.Mesh(flashGeometry,flashMaterial);flash.position.z=camera.position.z-10;flash.lookAt(camera.position);scene.add(flash);gsap.to(flashMaterial,{opacity:0,duration:0.8,ease:"power2.out",onComplete:function(){scene.remove(flash);}});}
function createWaveSource(position,isAuto=false){const waveSource={position:position,rings:[],speed:0.5+0.5*Math.random()*speed,startTime:clock.getElapsedTime(),lastRingTime:clock.getElapsedTime(),isAuto:isAuto,frequency:0.5+2*Math.random(),amplitude:0.5+1.5*Math.random(),phaseShift:Math.random()*Math.PI*2,distortion:0.3*Math.random(),pulsate:Math.random()>0.5,wobble:Math.random()>0.7};waveSources.push(waveSource);return waveSource;}
function createWaveAtClick(event){if(event.target.closest('#home-button')||event.target.closest('.control-button')){return;}
mouse.x=event.clientX/window.innerWidth*2-1;mouse.y=-(event.clientY/window.innerHeight)*2+1;raycaster.setFromCamera(mouse,camera);const plane=new THREE.Plane(new THREE.Vector3(0,1,0),-waveParams.height);const targetPoint=new THREE.Vector3();raycaster.ray.intersectPlane(plane,targetPoint);const flashGeometry=new THREE.CircleGeometry(1,32);const flashMaterial=new THREE.MeshBasicMaterial({color:isDarkMode?0xffffff:0x333333,transparent:true,opacity:0.8,side:THREE.DoubleSide});const flash=new THREE.Mesh(flashGeometry,flashMaterial);flash.position.set(targetPoint.x,waveParams.height+0.1,targetPoint.z);flash.rotation.x=-Math.PI/2;scene.add(flash);gsap.to(flash.scale,{x:3,y:3,z:1,duration:0.5,ease:"power1.out"});gsap.to(flashMaterial,{opacity:0,duration:0.5,ease:"power1.out",onComplete:function(){scene.remove(flash);}});createWaveSource(targetPoint);}
function createWaveRing(source,radius){const segments=Math.max(32,Math.floor(radius*4));let geometry=new THREE.RingGeometry(radius,radius+ringWidth,segments);let ringColor=new THREE.Color(isDarkMode?0xffffff:0x222222);const baseOpacity=isDarkMode?0.7:0.8;let opacity=baseOpacity;if(source.pulsate){const pulsePhase=(clock.getElapsedTime()*source.frequency)%(Math.PI*2);const pulseFactor=0.3*Math.sin(pulsePhase)+0.7;opacity*=pulseFactor;}
const material=new THREE.MeshBasicMaterial({color:ringColor,transparent:true,opacity:opacity,side:THREE.DoubleSide,wireframe:false,depthWrite:false});const ring=new THREE.Mesh(geometry,material);ring.rotation.x=-Math.PI/2;let posY=waveParams.height+0.01;if(source.wobble){const time=clock.getElapsedTime();posY+=Math.sin(time*source.frequency+source.phaseShift)*0.1;}
ring.position.set(source.position.x,posY,source.position.z);ring.userData={radius:radius,birthTime:clock.getElapsedTime(),source:source};scene.add(ring);source.rings.push(ring);waveRings.push(ring);return ring;}
function updateWaves(){const currentTime=clock.getElapsedTime();for(let i=0;i<waveSources.length;i++){const source=waveSources[i];const age=currentTime-source.startTime;const maxAge=source.isAuto?20:40;if(age>maxAge&&!(source.position.x===0&&source.position.z===0)){for(let j=0;j<source.rings.length;j++){gsap.to(source.rings[j].material,{opacity:0,duration:0.5});}
waveSources.splice(i,1);i--;continue;}
const ringInterval=source.isAuto?0.6/source.speed:0.4/source.speed;if(currentTime-source.lastRingTime>ringInterval){source.lastRingTime=currentTime;createWaveRing(source,waveParams.minRadius);}
for(let j=0;j<source.rings.length;j++){let ring=source.rings[j];const ringAge=currentTime-ring.userData.birthTime;const baseGrowthSpeed=source.speed*5;let growthSpeed=baseGrowthSpeed;if(source.pulsate){growthSpeed*=1+0.2*Math.sin(currentTime*source.frequency);}
const newRadius=waveParams.minRadius+ringAge*growthSpeed;if(newRadius>waveParams.maxRadius){scene.remove(ring);source.rings.splice(j,1);const globalindex=waveRings.indexOf(ring);if(globalindex!==-1){waveRings.splice(globalindex,1);}
j--;continue;}
let opacityFactor=1-(newRadius/waveParams.maxRadius);if(source.pulsate){opacityFactor*=0.7+0.3*Math.sin(ringAge*source.frequency*3);}
const baseOpacity=isDarkMode?0.7:0.8;ring.material.opacity=baseOpacity*opacityFactor;if(source.isAuto){const hsl={};ring.material.color.getHSL(hsl);const hueShift=ringAge*0.1*source.frequency;ring.material.color.setHSL((hsl.h+hueShift)%1,hsl.s,hsl.l*(0.8+0.2*Math.sin(ringAge*2)));}
if(Math.abs(ring.userData.radius-newRadius)>0.1){scene.remove(ring);const newGeometry=new THREE.RingGeometry(newRadius,newRadius+ringWidth,Math.max(32,Math.floor(newRadius*4)));const newRing=new THREE.Mesh(newGeometry,ring.material);newRing.rotation.x=-Math.PI/2;newRing.position.copy(ring.position);newRing.userData={radius:newRadius,birthTime:ring.userData.birthTime,source:source};scene.add(newRing);source.rings[j]=newRing;const globalindex=waveRings.indexOf(ring);if(globalindex!==-1){waveRings[globalindex]=newRing;}
ring=newRing;}}}}
function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);}
function onMouseMove(event){if(rotationMode)return;mouse.x=event.clientX/window.innerWidth*2-1;mouse.y=-(event.clientY/window.innerHeight)*2+1;gsap.to(camera.position,{x:mouse.x*5,z:20-Math.abs(mouse.y)*5,y:15+mouse.y*3,duration:2,ease:"power2.out"});camera.lookAt(0,0,0);}
function onKeyDown(event){switch(event.key.toLowerCase()){case"w":waveCount=Math.min(waveCount+5,50);break;case"s":waveCount=Math.max(waveCount-5,5);break;case"a":speed=Math.max(speed-0.1,0.2);for(let i=0;i<waveSources.length;i++)
waveSources[i].speed=Math.max(waveSources[i].speed*0.9,0.2);break;case"d":speed=Math.min(speed+0.1,3);for(let i=0;i<waveSources.length;i++)
waveSources[i].speed=Math.min(waveSources[i].speed*1.1,3);break;case"z":ringWidth=Math.max(ringWidth-0.01,0.01);break;case"x":ringWidth=Math.min(ringWidth+0.01,0.2);break;case"q":colorindex=(colorindex-1+colors.length)%colors.length;break;case"e":colorindex=(colorindex+1)%colors.length;break;case"r":rotationMode=!rotationMode;break;case"f":autoWaveGeneration=!autoWaveGeneration;break;case"m":currentMagicPalette=(currentMagicPalette+1)%magicPalettes.length;break;case"t":toggleTheme();break;case" ":rotationMode=false;gsap.to(camera.position,{x:0,y:15,z:20,duration:1.5,ease:"power2.inOut"});camera.lookAt(0,0,0);break;case"c":const angle=Math.random()*Math.PI*2;const radius=5+10*Math.random();const x=Math.cos(angle)*radius;const z=Math.sin(angle)*radius;createWaveSource(new THREE.Vector3(x,0,z));break;}}
function updateCamera(){if(rotationMode){cameraOrbit+=0.003;const radius=25;camera.position.x=Math.cos(cameraOrbit)*radius;camera.position.z=Math.sin(cameraOrbit)*radius;camera.lookAt(0,0,0);}}
function updateBackgroundParticles(){const particles=scene.getObjectByName("backgroundParticles");if(particles){particles.rotation.y+=0.0003;particles.rotation.x+=0.0001;const time=clock.getElapsedTime();const sizes=particles.geometry.attributes.size;const twinklePhases=particles.userData.twinklePhases;const originalSizes=particles.userData.originalSizes;for(let i=0;i<sizes.count;i++){const baseSize=originalSizes[i];const twinkle=Math.sin(time*(1+i%10)*0.2+twinklePhases[i])*0.4+0.6;sizes.setX(i,baseSize*twinkle);}
sizes.needsUpdate=true;}}
function animate(){requestAnimationFrame(animate);updateWaves();updateCamera();updateBackgroundParticles();renderer.render(scene,camera);}
window.addEventListener('load',()=>{new CustomCursor();setTimeout(()=>{loadingNumberEl.classList.add('number-pulsing');animationId=requestAnimationFrame(animateLoadingNumber);},500);});</script>
</body>
</html>
